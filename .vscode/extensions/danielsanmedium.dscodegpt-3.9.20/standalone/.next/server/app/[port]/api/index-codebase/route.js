"use strict";(()=>{var e={};e.id=2141,e.ids=[2141],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},17718:e=>{e.exports=require("node:child_process")},91648:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>l,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>x,staticGenerationAsyncStorage:()=>d});var a=r(49303),o=r(88716),n=r(60670),i=r(3518),p=e([i]);i=(p.then?(await p)():p)[0];let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/[port]/api/index-codebase/route",pathname:"/[port]/api/index-codebase",filename:"route",bundlePath:"app/[port]/api/index-codebase/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/index-codebase/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:x}=u,h="/[port]/api/index-codebase/route";function l(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:d})}s()}catch(e){s(e)}})},3518:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>u});var a=r(92810),o=r(51371),n=r(82687),i=r(75421),p=r(74506),l=e([a,o,n,p]);[a,o,n,p]=l.then?(await l)():l;let c=(e,t,r="")=>{e.enqueue(JSON.stringify({progress:Math.min(Math.round(t),100),total:100,message:r})+"\n\n")};async function u(){let e=await (0,p.Z)();if(!e)return Response.json({message:"No Session found"},{status:401});try{let t=new ReadableStream({async start(t){c(t,1,"Getting files");let r=(await (0,a.getAllPathsFromProject)()).filter(e=>!o.Wy.test(e)&&!/(^|\/)\./.test(e)),s=await Promise.all(r.map(e=>(0,a.getFileContent)(e)));c(t,5,"Reading files");let i=(await Promise.all(r.map((e,t)=>(0,o.qm)({fileName:e,fileContent:s[t]})))).flat(1);c(t,10,"Reading files");let{workspaceId:p}=await (0,o.cm)();if(!p)return;let l=new Set(await (0,o.ln)({workspaceId:p,session:e})),u=new Set(i.map(e=>e.hash)),d=new Set([...l].filter(e=>!u.has(e))),x=i.filter(e=>!l.has(e.hash));c(t,20,"Reading files");let h=Array.from({length:Math.ceil(x.length/288)},(e,t)=>x.slice(288*t,288*t+288));for(let[r,s]of h.entries()){let a=performance.now(),i=20+r/h.length*75,l=20+(r+1)/h.length*75,u=(l-i)/8,d=setInterval(()=>{let e=performance.now()-a,r=Math.floor(e/1e3);if(r<8){let e=i+u*r;c(t,e,"Indexing Project")}},1e3),x=await (0,o.oQ)({chunks:s,workspaceId:p,session:e});x.length>0&&n.OZ.upsert(x.map(e=>({workspace_id:p,origin_file:e.fileName,hash:e.hash}))),clearInterval(d),c(t,l,"Indexing Project")}c(t,95,"Finalizing"),await (0,o.$O)({request:{workspaceId:p,chunks:[]},session:e}),d.size>0&&(await (0,o.bU)({workspaceId:p,session:e,hashes:Array.from(d)}),n.OZ.delete(p,Array.from(d))),t.close()}});return new i.w(t)}catch(e){return console.log(e),Response.json({message:e.message},{status:500})}}s()}catch(e){s(e)}})},49303:(e,t,r)=>{e.exports=r(30517)},75421:(e,t,r)=>{r.d(t,{w:()=>s});class s extends Response{constructor(e,t){super(e,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...t?.headers}})}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,1242,4599,9092,6510,9712,8811,3375,2687,7807,9836,1371],()=>r(91648));module.exports=s})();
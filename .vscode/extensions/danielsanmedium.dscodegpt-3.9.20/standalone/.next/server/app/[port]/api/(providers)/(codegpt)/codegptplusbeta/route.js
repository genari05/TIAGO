"use strict";(()=>{var e={};e.id=5362,e.ids=[5362],e.modules={65372:e=>{e.exports=require("better-sqlite3-multiple-ciphers")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},20629:e=>{e.exports=require("fs/promises")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},98061:e=>{e.exports=require("node:assert")},92761:e=>{e.exports=require("node:async_hooks")},72254:e=>{e.exports=require("node:buffer")},17718:e=>{e.exports=require("node:child_process")},40027:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},65714:e=>{e.exports=require("node:diagnostics_channel")},30604:e=>{e.exports=require("node:dns")},15673:e=>{e.exports=require("node:events")},88849:e=>{e.exports=require("node:http")},42725:e=>{e.exports=require("node:http2")},87503:e=>{e.exports=require("node:net")},38846:e=>{e.exports=require("node:perf_hooks")},39630:e=>{e.exports=require("node:querystring")},84492:e=>{e.exports=require("node:stream")},31764:e=>{e.exports=require("node:tls")},41041:e=>{e.exports=require("node:url")},47261:e=>{e.exports=require("node:util")},93746:e=>{e.exports=require("node:util/types")},24086:e=>{e.exports=require("node:worker_threads")},65628:e=>{e.exports=require("node:zlib")},64254:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>d,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var s=r(49303),a=r(88716),n=r(60670),i=r(96369),p=e([i]);i=(p.then?(await p)():p)[0];let u=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/[port]/api/(providers)/(codegpt)/codegptplusbeta/route",pathname:"/[port]/api/codegptplusbeta",filename:"route",bundlePath:"app/[port]/api/(providers)/(codegpt)/codegptplusbeta/route"},resolvedPagePath:"/Users/maol/WebstormProjects/Trabajo/codegpt-nextjs/app/[port]/api/(providers)/(codegpt)/codegptplusbeta/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:g}=u,m="/[port]/api/(providers)/(codegpt)/codegptplusbeta/route";function d(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}o()}catch(e){o(e)}})},96369:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{GET:()=>f,HEAD:()=>h,POST:()=>y,dynamic:()=>q});var s=r(92810),a=r(77807),n=r(82687),i=r(56342),p=r(61740),d=r(315),u=r(76129),l=r(75421),c=r(89874),g=r(94750),m=r(74506),x=e([s,n,i,d,c,g,m]);[s,n,i,d,c,g,m]=x.then?(await x)():x;let q="force-dynamic",w=a.xf;async function h(){let e=await (0,m.Z)();return Response.json("",{status:e||n.ZI.getByProvider("CodeGPT Plus Beta")?.apikey?200:401})}let v=async(e,t)=>{await (0,s.cleanKVCache)({type:"agents",currentKey:e});try{let r={Authorization:`Bearer ${e}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",...t?{"CodeGPT-Org-Id":t}:{}},o=await Promise.all([fetch(`${a.xf}/agents`,{headers:r}).then(e=>e.json()),fetch(`${a.xf}/agents/marketplace-favorites`,{headers:r}).then(e=>e.json())]),n={agents:Array.isArray(o[0])?o[0]:[],marketplace:Array.isArray(o[1])?o[1]:[]};return(0,s.setKeyValue)(`agents-${e}`,n),n}catch(e){return console.log({agentsError:e.message}),{agents:[],marketplace:[]}}};async function f(){try{let e=n.ZI.getByProvider("CodeGPT Plus Beta"),t=e?.organization_id,r=await (0,m.Z)()||e?.apikey;if(!r)return Response.json({agents:[],marketplace:[]});{let e=await (0,s.getKeyValue)(`agents-${r}`);if(e)return v(r,t),Response.json(e);{let e=await v(r,t);return Response.json(e)}}}catch(e){return console.log(e),Response.json(e.message,{status:e.status??500})}}async function y(e){var t;let r=n.ZI.getByProvider("CodeGPT Plus Beta"),{messages:o}=await e.json(),a=o[o.length-1],{image:x}=a,h=await (0,s.getDefaultAgent)(),f=x?"gpt-4o-mini":e.headers.get("model")||h.id,y="true"===e.headers.get("fromMarketplace")||f===h.id;console.log("Agent from Marketplace",y),o=await (0,d.Dz)({messages:o,fromMarketplace:y,provider:"CodeGPT Plus Beta"});let q=e.headers.get("filePath"),v=e.headers.get("promptType"),P="53f3c928-9d9f-4aae-a3e1-058d657f286a"===f||"stackOverflow"===v,k=await g.Z.getLanguage(),C=await g.Z.getIdeLanguage(),b=e.headers.get("fileName")??"",j="Chat",$=a?.codeSelection??"";if(v&&!P){j=v+"CodeGPT";let e=await (0,u.u)({promptType:v,cleanPromptText:a.content+$,language:C});e&&(o[o.length-1].content=e+a.content+$)}if(q){let e=JSON.stringify(await (0,s.getFileContent)(q),null,2);o[o.length-1].content+=`${q}

    ${e}`}let T=(t=(t=f??"").toLowerCase(),!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(t));T&&x&&(o=[{role:"system",content:[{type:"text",text:"You have provided an image. I will describe it unless you provide a specific instruction."}]},{role:"user",content:[{type:"image_url",image_url:{url:x,detail:"high"}},...a.content?[{type:"text",text:a.content}]:[]]}]),P&&o.push({role:"system",content:`- You have been asked to search Stack Overflow for the given query.
- Use the searchStackOverflow function to search Stack Overflow and retrieve the most relevant results to respond to the user's query and give to user a complete response.`});try{let e=r?.organization_id,t=await (0,m.Z)(),u=!!(t||r?.apikey),x=a.statusId,h=n.vc.getByProvider("CodeGPT Plus Beta");o=(0,d.VL)(o);let C={...T?{model:f?.toLowerCase()}:{agentId:f},messages:o,temperature:h?.temperature??0,statusId:x},_=u?T?`${w}/chat/completion`:y?`${w}/chat/marketplace/agents`:`${w}/chat/extension`:`${w}/chat/limited`;console.log({isStackOverflow:P}),console.log({model:f,url:_});let A=n.PR.get(),I=A?.signed_distinct_id||"",B=A?.distinct_id||"",G=await (0,s.getKeyValue)("anonymousDistinctId"),O=async({messages:o,useFunctionPrompt:s,removeEmptyMessage:a})=>await fetch(_,{method:"POST",headers:{Authorization:`Bearer ${t||r?.apikey||""}`,"Content-Type":"application/json",tokens:"true",source:"api",channel:p.L_,"codegpt-version":await g.Z.getVersion(),"distinct-id":B||G,...I?{"X-Signed-Distinct-Id":I}:{},...e?{"CodeGPT-Org-Id":e}:{}},body:JSON.stringify({...C,messages:o,stream:!0,format:"json"})}),R=await O({messages:o,useFunctionPrompt:!1});if(console.log(R),R.ok||console.log({status:R.status,text:await R.text()}),(0,i.sendEvent)({eventName:j,provider:"CodeGPT Plus Beta",model:T?f??"gpt-4o-mini":"agentId: "+f,statusCode:R.status}),429===R.status)return Response.json({message:"You have reached your daily request limit. Connecto to CodeGPT Plus to increase your free daily limit or upgrade your plan for unlimited interactions."},{status:429});let S=o.slice(0,-1).some(e=>e.content.includes($));if(q||$&&(v||!S)){let e=await (0,c.VU)([`<p style='display: flex; align-items: center; gap: 0.5rem;'>${v?`<span class='command command-bordered command-with-icon' data-command='command'><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${v}</span></span>`:""}${b?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-id=${k} data-language=${k}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${b}</span></span>`:""}${q?`<span class='command command-bordered command-with-icon animate-slideIn relative h-auto items-center gap-1 overflow-hidden' data-language=${q.split("/").pop()?.split(".").pop()}><span class='max-w-48 overflow-hidden text-ellipsis whitespace-pre break-words pr-1 font-mono text-sm text-foreground'>${q.split("/").pop()}</span></span>`:""}</p>

`],R.body),t=(0,c.q_)(e,O,o);return new l.w(t)}let Z=(0,c.q_)((0,c.lg)(R),O,o);return new l.w(Z)}catch(e){return(0,i.sendEvent)({eventName:j,provider:"CodeGPT Plus Beta",model:T?f??"gpt-4o":"agentId: "+f,statusCode:e.status??500}),Response.json({message:e.message,status:e.status??500},{status:e.status??500})}}o()}catch(e){o(e)}})},49303:(e,t,r)=>{e.exports=r(30517)},75421:(e,t,r)=>{r.d(t,{w:()=>o});class o extends Response{constructor(e,t){super(e,{...t,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":"false",...t?.headers}})}}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,1242,4599,9092,6510,9712,8811,3375,8268,2687,7807,9836,1371,2377],()=>r(64254));module.exports=o})();
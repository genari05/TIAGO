"use strict";exports.id=1371,exports.ids=[1371],exports.modules={87385:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{setVicunaSession:()=>d});var s=r(24330);r(60166);var a=r(77807),o=r(82687),i=r(50249),c=r(71615),h=r(40618),l=e([o]);o=(l.then?(await l)():l)[0];let d=async({accessToken:e,refreshToken:t,expiresAt:r})=>{console.log("SET VICUNA SESSION"),e||t||r||(0,i.R)((0,c.cookies)()).auth.signOut({scope:"local"}).catch(e=>console.log(e));let n=e||o.ZI.getByProvider("CodeGPT Plus Beta")?.apikey,s=await fetch(`${a.xf}/me`,{method:"GET",cache:"no-store",...n?{headers:{Authorization:`Bearer ${n}`}}:{}}),h=await s.json(),l=h?.user?.distinct_id,d=h?.signedDistinctId;o.PR.upsert({access_token:e,refresh_token:t,expires_at:Number(r),signed_distinct_id:d,distinct_id:l})};(0,h.h)([d]),(0,s.j)("cb8707d39cee2d6b73f7d2a0c3a37eb9243fb61d",d),n()}catch(e){n(e)}})},74506:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{Z:()=>h});var s=r(87385),a=r(82687),o=r(50249),i=r(71615),c=e([s,a]);async function h(){let e=a.PR.get(),t=e?.access_token;if(t&&parseInt(e?.expires_at+"000")<Date.now()){let r=(0,o.R)((0,i.cookies)()),{data:n,error:a}=await r.auth.refreshSession({refresh_token:e?.refresh_token});a?(console.log("vicu\xf1a refreshSession error: ",a.message),(a.message.includes("Refresh Token Not Found")||a.message.includes("Already Used"))&&await (0,s.setVicunaSession)({accessToken:"",refreshToken:"",expiresAt:""})):(await (0,s.setVicunaSession)({accessToken:n.session.access_token,refreshToken:n.session.refresh_token,expiresAt:String(n.session.expires_at)}),t=n.session.access_token)}return t||void 0}[s,a]=c.then?(await c)():c,n()}catch(e){n(e)}})},51371:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{$O:()=>g,Nt:()=>p,Sk:()=>u,Wy:()=>l,bU:()=>E,cm:()=>m,ln:()=>k,oQ:()=>w,qm:()=>y});var s=r(92810),a=r(74506),o=r(82687),i=r(77807),c=r(50723),h=e([s,a,o]);[s,a,o]=h.then?(await h)():h;let l=new RegExp(["csv","tsv","psv","dsv","dat","xlsb","prn","sdf","tsk","xml","rdata","rds","parquet","avro","orc","feather","h5","hdf5","pkl","arff","csvz","tsvz","ndjson"].map(e=>`\\.${e}$`).join("|")),d=async()=>{try{let e=await (0,s.getWorkspaceFolder)();if(!e)return{projectId:"",workspaceFolder:""};let t=await o.EE.get(e);return t||(t=crypto.randomUUID(),o.EE.upsert({key:e,value:t})),{projectId:t,workspaceFolder:e}}catch{return{projectId:"",workspaceFolder:""}}},f=async e=>{let t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("")},g=async({request:e,session:t})=>{try{if(!(await fetch(`${i.QW}/codebase/insert-chunks-v2`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error(`No response from ${i.QW}`)}catch(e){throw Error(`insertEmbeddings: ${e.message}`)}},m=async()=>{try{let{projectId:e,workspaceFolder:t}=await d();if(!e||!t)return null;let r=await (0,a.Z)(),n=o.ZI.getByProvider("CodeGPT Plus Beta")?.apikey,s=await fetch(`${i.xf}/codebase/workspace-id-v2`,{method:"POST",headers:{Authorization:`Bearer ${r||n}`,"Content-Type":"application/json"},body:JSON.stringify({projectId:e,name:t})});if(!s.ok)throw Error(`No response from ${i.xf}`);return await s.json()}catch(e){console.log(`getWorkspaceId: ${e.message}`)}},u=async({query:e,path:t})=>{let r=await (0,a.Z)();if(!r)return[];let{workspaceId:n}=await m();try{let s=await fetch(`${i.xf}/codebase/get-chunks`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({query:e,path:t,workspaceId:n})});if(!s.ok)throw Error(`getChunks: No response from ${i.xf}`);let a=await s.json();if(a)return a;return[]}catch(e){throw Error(`getChunks: ${e.message}`)}},p=async({query:e,chunks:t})=>{let r=await (0,a.Z)();if(!r)return[];try{let n=await fetch(`${i.xf}/reranker`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({query:e,chunks:t})});if(!n.ok)throw Error(`rerankChunks: No response from ${i.xf}`);let s=await n.json();if(s)return s;return[]}catch(e){throw Error(`rerankChunks: ${e.message}`)}},y=async({fileName:e,fileContent:t})=>{let r="object"==typeof t?JSON.stringify(t,void 0,2):t;if(""===r.trim()||e.endsWith("json")&&r.split("\n").length>2e3)return[];let n=r.split("\n");if(n.length>1e4||n[0].length>5e3)return[];let s=await (0,c.H)({content:r,maxLines:25,overlapLines:3,trimEmpty:!1}),a=await Promise.all(s.map(e=>f(e.content)));return s.map((t,r)=>({content:t.content,startLine:t.startLine,endLine:t.endLine,fileName:e,hash:a[r]}))},w=async({chunks:e,workspaceId:t,session:r})=>{try{if(e.length>0)return await g({request:{workspaceId:t,chunks:e},session:r}),e;return[]}catch(e){if(console.error("Failed to generate embeddings:",e.message),e.message.includes("getEmbeddings"))throw Error(`Failed to get Embeddings from API - ${e.message}`);return[]}},k=async({workspaceId:e,session:t})=>{try{let r=o.OZ.get(e)?.map(e=>e.hash);if(!r||0===r.length){let n=await fetch(`${i.QW}/codebase/hashes/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw Error(`No response from ${i.QW}`);r=await n.json()}return r}catch(e){throw Error(`getDBHashes: ${e.message}`)}},E=async({workspaceId:e,session:t,hashes:r})=>{try{t||=await (0,a.Z)(),console.log("TRYING TO REMOVE HASHES");let n=await fetch(`${i.QW}/codebase/clean`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({workspaceId:e,hashes:r})});if(console.log({response:n}),!n.ok)throw Error(`No response from ${i.QW} ${n.status}`);return await n.json()}catch(e){throw Error(`removeHashes: ${e.message}`)}};n()}catch(e){n(e)}})},50723:(e,t,r)=>{r.d(t,{H:()=>n}),r(3375);async function n({content:e,maxLines:t,overlapLines:r,trimEmpty:n=!0,minLines:s=1}){if(t<=0)throw Error("maxLines must be positive");if(r>=t)throw Error("overlapLines must be less than maxLines");if(r<0)throw Error("overlapLines must be non-negative");if(s>t)throw Error("minLines must be less than or equal to maxLines");if(s<=0)throw Error("minLines must be positive");let a=e.split("\n");n&&(a=a.filter(e=>e.trim().length>0));let o=[];if(a.length<=t)return[{content:a.join("\n"),startLine:0,endLine:a.length-1}];let i=0,c=0,h=2*Math.ceil(a.length/(t-r));for(;i<a.length;){if(++c>h){console.warn("Maximum iterations reached. Processing remaining content as final chunk.");let e=a.slice(i);e.length>0&&o.push({content:e.join("\n"),startLine:i,endLine:a.length-1});break}let e=Math.min(i+t,a.length);if(e<a.length){let r=Math.min(e+Math.floor(t/2),a.length),n=!1;for(let t=e;t<r;t++)if(""===a[t].trim()){e=t+1,n=!0;break}n||(e=Math.min(i+t,a.length))}e-i<s&&(e=Math.min(i+s,a.length));let n=a.slice(i,e).join("\n");n.trim().length>0&&o.push({content:n,startLine:i,endLine:e-1});let l=e-r;if(l<=i?i+=1:i=l,e>=a.length)break}if(o.length>1){let e=o[o.length-1];if(e.endLine-e.startLine+1<10){let t=o[o.length-2],r=Math.max(0,t.endLine-e.startLine+1),n=e.content.split("\n").slice(r);t.content=t.content+(n.length>0?"\n"+n.join("\n"):""),t.endLine=e.endLine,o.pop()}}return o}},50249:(e,t,r)=>{r.d(t,{R:()=>o});var n=r(16510);let s="https://auth.codegpt.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyb3h1dnNyc2RieGFjb2twcmF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTU0OTEyNzgsImV4cCI6MjAxMTA2NzI3OH0.fyyxVq2c2eLIExMQEUxP8wNoyY2UumBrfN5So16TCno";(0,n.createBrowserClient)(s,a);let o=e=>(0,n.createServerClient)(s,a,{cookies:{get:t=>e.get(t)?.value,set(t,r,n){try{e.set({name:t,value:r,...n})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}})}};